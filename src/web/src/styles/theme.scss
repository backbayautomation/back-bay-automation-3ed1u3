// =============================================================================
// Core Theme Stylesheet
// Implements design system with WCAG 2.1 AA compliance and dark mode support
// Version: 1.0.0
// =============================================================================

@import './variables';

// -----------------------------------------------------------------------------
// Root Variables & Global Settings
// -----------------------------------------------------------------------------

:root {
  // Global transition settings
  --transition-speed: 0.3s;
  --focus-ring-color: #{$primary};
  --focus-ring-width: 3px;

  // Light mode default colors
  --background-color: #{$background-color};
  --text-primary: #{$text-primary};
  --text-secondary: #{$text-secondary};
  --surface-color: #{$background-secondary};
  --button-bg: #{$primary};
  --button-text: #{$background-color};
  --card-shadow: #{$shadow-md};
}

// -----------------------------------------------------------------------------
// Base Styles
// -----------------------------------------------------------------------------

html {
  box-sizing: border-box;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

*, *::before, *::after {
  box-sizing: inherit;
  margin: 0;
  padding: 0;
}

body {
  font-family: $font-family-primary;
  font-size: clamp(16px, 1vw + 0.5rem, 18px);
  line-height: $line-height-base;
  color: var(--text-primary);
  background-color: var(--background-color);
  transition: background-color var(--transition-speed),
              color var(--transition-speed);
}

// -----------------------------------------------------------------------------
// Fluid Typography Function
// -----------------------------------------------------------------------------

@function generateFluidType($minSize, $maxSize, $minWidth, $maxWidth) {
  $slope: ($maxSize - $minSize) / ($maxWidth - $minWidth);
  $yAxisIntersection: -$minWidth * $slope + $minSize;
  
  @return clamp(
    #{$minSize}px,
    #{$yAxisIntersection}px + #{$slope * 100}vw,
    #{$maxSize}px
  );
}

// -----------------------------------------------------------------------------
// Container Query Mixin
// -----------------------------------------------------------------------------

@mixin generateContainerQueries($containerName, $breakpoints) {
  container-type: inline-size;
  container-name: $containerName;

  @each $name, $size in $breakpoints {
    @container #{$containerName} (min-width: #{$size}) {
      @content($name, $size);
    }
  }
}

// -----------------------------------------------------------------------------
// Accessibility Utilities
// -----------------------------------------------------------------------------

.a11y {
  &-sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  &-focus-visible {
    outline: var(--focus-ring-width) solid var(--focus-ring-color);
    outline-offset: 2px;
  }

  &-skip-link {
    position: fixed;
    top: -100px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--background-color);
    padding: $spacing-sm $spacing-md;
    border: 1px solid var(--text-primary);
    border-radius: $border-radius-sm;
    z-index: $z-index-tooltip;

    &:focus {
      top: $spacing-sm;
    }
  }
}

// -----------------------------------------------------------------------------
// Layout System
// -----------------------------------------------------------------------------

.layout {
  &-container {
    @include generateContainerQueries(main-content, (
      mobile: $breakpoint-mobile,
      tablet: $breakpoint-tablet,
      desktop: $breakpoint-desktop,
      large: $breakpoint-large
    ));
    max-width: $container-max-width;
    margin: 0 auto;
    padding: 0 max(#{$container-padding}, 5%);
  }

  &-grid {
    display: grid;
    grid-template-columns: repeat(var(--cols, #{$grid-columns}), 1fr);
    gap: var(--gap, #{$grid-gutter});

    @container main-content (width < #{$breakpoint-tablet}) {
      --cols: 6;
      --gap: #{$grid-gutter / 2};
    }
  }
}

// -----------------------------------------------------------------------------
// Enhanced Component Styles
// -----------------------------------------------------------------------------

.components {
  &-button {
    padding: $spacing-sm $spacing-md;
    border-radius: $border-radius-sm;
    font-family: $font-family-primary;
    font-weight: $font-weight-medium;
    background-color: var(--button-bg);
    color: var(--button-text);
    border: none;
    cursor: pointer;
    transition: all var(--transition-speed);

    &:focus-visible {
      @extend .a11y-focus-visible;
    }

    &:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  }

  &-card {
    background-color: var(--surface-color);
    border-radius: $border-radius-md;
    padding: $spacing-md;
    box-shadow: var(--card-shadow);
    transition: box-shadow var(--transition-speed);

    &:hover {
      box-shadow: $shadow-lg;
    }
  }
}

// -----------------------------------------------------------------------------
// Dark Mode Support
// -----------------------------------------------------------------------------

@media (prefers-color-scheme: dark) {
  :root {
    --background-color: #{$dark-background-color};
    --text-primary: #{$dark-text-primary};
    --text-secondary: #{$dark-text-secondary};
    --surface-color: #{$dark-background-secondary};
    --button-bg: #{$primary-light};
    --button-text: #{$dark-text-primary};
    --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
  }
}

// -----------------------------------------------------------------------------
// High Contrast Mode Support
// -----------------------------------------------------------------------------

@media (forced-colors: active) {
  :root {
    --focus-ring-color: CanvasText;
    --button-bg: ButtonText;
    --button-text: ButtonFace;
    --card-shadow: none;
  }

  .components-button {
    border: 1px solid ButtonText;
  }

  .components-card {
    border: 1px solid CanvasText;
  }
}

// -----------------------------------------------------------------------------
// Print Styles
// -----------------------------------------------------------------------------

@media print {
  body {
    background-color: white;
    color: black;
  }

  .components-card {
    box-shadow: none;
    border: 1px solid black;
  }

  .a11y-skip-link,
  .components-button {
    display: none;
  }
}